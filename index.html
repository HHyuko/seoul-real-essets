
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>단지 분석 (모바일)</title>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<style>
  html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
    background:#f3f4f6;
  }
  .wrap {
    height: 100vh;
    display:flex;
    flex-direction:column;
  }
  .top {
    background:#fff;
    padding:12px;
    border-bottom:1px solid #e5e7eb;
  }
  .title {
    font-size:16px;
    font-weight:700;
    margin:0 0 10px 0;
  }
  .row {
    display:flex;
    gap:8px;
    align-items:center;
  }
  #region, #q, #btnReset {
    padding:10px;
    font-size:14px;
    border-radius:12px;
    border:1px solid #d1d5db;
  }
  #q { flex:1; }
  .bands {
    margin-top:10px;
    display:flex;
    gap:8px;
    overflow-x:auto;
  }
  .band {
    padding:8px 12px;
    border-radius:999px;
    border:1px solid #d1d5db;
    background:#f9fafb;
    font-size:13px;
    font-weight:700;
    cursor:pointer;
  }
  .band.active {
    background:#111827;
    color:#fff;
    border-color:#111827;
  }
  #plot { flex:1; }
  .bottom {
    background:#fff;
    border-top:1px solid #e5e7eb;
    padding:10px;
    height:260px;
  }
  .card {
    background:#f8fafc;
    border:1px solid #e5e7eb;
    border-radius:14px;
    padding:12px;
    height:100%;
    overflow:auto;
  }
  .grid {
    display:grid;
    grid-template-columns:90px 1fr;
    gap:6px 10px;
    font-size:13px;
  }
  .k { color:#6b7280; }
  .v { font-weight:600; }
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <p class="title">가격상승률 × 연평균 회전률</p>
    <div class="row">
      <select id="region">
        <option value="__ALL__">전체 지역</option>
      </select>
      <input id="q" placeholder="단지명 검색"/>
      <button id="btnReset">리셋</button>
    </div>
    <div class="bands" id="bands"></div>
  </div>

  <div id="plot"></div>

  <div class="bottom">
    <div id="info" class="card">
      <b>선택 정보</b>
      <p style="color:#9ca3af;font-size:13px;">점을 선택하세요</p>
    </div>
  </div>
</div>

<script>
/* ===== 샘플 데이터 (형식만 맞춰둠) ===== */
const rawData = [
  {name:"A단지", region:"강남", priceBand:"6억~8억", priceGrowth:12.3, turnover:0.45},
  {name:"B단지", region:"강남", priceBand:"8억~10억", priceGrowth:5.1, turnover:0.22},
  {name:"C단지", region:"송파", priceBand:"6억~8억", priceGrowth:9.7, turnover:0.38},
  {name:"D단지", region:"마포", priceBand:"4억~6억", priceGrowth:3.2, turnover:0.15}
];

const BASE_POINT_SIZE = 6;
const ACTIVE_POINT_SIZE = 12;

let selectedRegion = "__ALL__";
let selectedPriceBand = "__ALL__";

/* ===== 초기 UI 세팅 ===== */
function initUI() {
  const regions = [...new Set(rawData.map(d => d.region))];
  regions.forEach(r => {
    const opt = document.createElement("option");
    opt.value = r;
    opt.textContent = r;
    document.getElementById("region").appendChild(opt);
  });

  const bands = [...new Set(rawData.map(d => d.priceBand))];
  bands.unshift("__ALL__");
  bands.forEach(b => {
    const btn = document.createElement("div");
    btn.className = "band" + (b==="__ALL__" ? " active" : "");
    btn.dataset.band = b;
    btn.textContent = b==="__ALL__" ? "전체 가격" : b;
    document.getElementById("bands").appendChild(btn);
  });
}

/* ===== 필터 ===== */
function getFilteredData() {
  return rawData.filter(d => {
    const rOK = selectedRegion==="__ALL__" || d.region===selectedRegion;
    const pOK = selectedPriceBand==="__ALL__" || d.priceBand===selectedPriceBand;
    return rOK && pOK;
  });
}

/* ===== 렌더 ===== */
function render() {
  const data = getFilteredData();

  const trace = {
    x: data.map(d => d.turnover),
    y: data.map(d => d.priceGrowth),
    mode: "markers",
    type: "scatter",
    marker: {
      size: BASE_POINT_SIZE,
      opacity: 0.85
    },
    customdata: data
  };

  Plotly.react("plot", [trace], {
    margin:{l:40,r:20,t:10,b:40},
    xaxis:{title:"연평균 회전률"},
    yaxis:{title:"가격상승률(%)"}
  }, {responsive:true});
}

/* ===== 이벤트 ===== */
document.getElementById("region").addEventListener("change", e => {
  selectedRegion = e.target.value;
  render();
});

document.getElementById("bands").addEventListener("click", e => {
  if (!e.target.classList.contains("band")) return;
  document.querySelectorAll(".band").forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");
  selectedPriceBand = e.target.dataset.band;
  render();
});

document.getElementById("plot").on("plotly_click", e => {
  const d = e.points[0].customdata;
  document.getElementById("info").innerHTML = `
    <b>${d.name}</b>
    <div class="grid">
      <div class="k">지역</div><div class="v">${d.region}</div>
      <div class="k">가격대</div><div class="v">${d.priceBand}</div>
      <div class="k">가격상승률</div><div class="v">${d.priceGrowth}%</div>
      <div class="k">회전률</div><div class="v">${d.turnover}</div>
    </div>
  `;
});

document.getElementById("btnReset").addEventListener("click", () => {
  selectedRegion="__ALL__";
  selectedPriceBand="__ALL__";
  document.getElementById("region").value="__ALL__";
  document.querySelectorAll(".band").forEach((b,i)=>{
    b.classList.toggle("active", i===0);
  });
  render();
});

initUI();
render();
</script>
</body>
</html>
